<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–ª–∞–¥–æ–º</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
        @media (max-width: 640px) {
            table thead { display: none; }
            table tr { display: block; margin-bottom: 1rem; border: 1px solid #e2e8f0; border-radius: 0.5rem; padding: 0.5rem; }
            table td { display: flex; justify-content: space-between; padding: 0.5rem !important; border: none !important; }
            table td::before { content: attr(data-label); font-weight: bold; color: #64748b; }
        }
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-8">

    <div class="max-w-5xl mx-auto">
        <h1 class="text-2xl md:text-3xl font-bold mb-6 text-gray-800 flex items-center gap-2">
            <span>üì¶</span> –°–∫–ª–∞–¥ –ü—Ä–æ–¥—É–∫—Ç–æ–≤
        </h1>

        <div class="bg-white p-5 md:p-6 rounded-xl shadow-md mb-8 border-l-4 border-indigo-500">
            <h2 class="text-lg font-semibold mb-4 text-gray-700" id="formTitle">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç</h2>
            <form id="productForm" onsubmit="saveProduct(event)" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <input type="hidden" id="productId">

                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" id="name" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition-all" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ú–æ–ª–æ–∫–æ">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">–¶–µ–Ω–∞ (‚ÇΩ)</label>
                    <input type="number" id="price" required step="0.01" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition-all" placeholder="0.00">
                </div>

                <div class="flex gap-2 items-end">
                    <button type="submit" id="submitBtn" class="flex-1 bg-indigo-600 text-white px-4 py-2.5 rounded-lg hover:bg-indigo-700 active:scale-95 transition font-medium text-sm">
                        –î–æ–±–∞–≤–∏—Ç—å
                    </button>
                    <button type="button" onclick="resetForm()" class="bg-gray-200 text-gray-700 px-4 py-2.5 rounded-lg hover:bg-gray-300 transition hidden text-sm" id="cancelBtn">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </form>
        </div>

        <div class="bg-white shadow-lg rounded-xl overflow-hidden">
            <div class="p-4 border-b bg-gray-50 flex flex-col sm:flex-row justify-between items-center gap-4">
                <div class="flex gap-2 w-full sm:max-w-md">
                    <input type="number" id="searchInput" placeholder="ID..." class="px-3 py-2 border rounded-lg text-sm w-20 sm:w-24 outline-none focus:ring-2 focus:ring-blue-400">
                    <button onclick="searchById()" class="bg-blue-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-600 transition flex-1 sm:flex-none">–ù–∞–π—Ç–∏</button>
                    <button onclick="fetchAll()" class="bg-gray-400 text-white px-4 py-2 rounded-lg text-sm hover:bg-gray-500 transition">–°–±—Ä–æ—Å</button>
                </div>
                <div class="text-sm text-gray-500 font-medium">–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤: <span id="count" class="text-indigo-600">0</span></div>
            </div>

            <table class="min-w-full leading-normal">
                <thead>
                    <tr class="bg-gray-800 text-white text-[11px] md:text-xs uppercase tracking-wider">
                        <th class="px-5 py-4 text-left">ID</th>
                        <th class="px-5 py-4 text-left">–ü—Ä–æ–¥—É–∫—Ç</th>
                        <th class="px-5 py-4 text-left">–¶–µ–Ω–∞</th>
                        <th class="px-5 py-4 text-right">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</th>
                    </tr>
                </thead>
                <tbody id="tableBody" class="text-sm">
                    </tbody>
            </table>
            
            <div id="loader" class="p-10 text-center text-gray-500 hidden">
                <div class="animate-spin inline-block w-6 h-6 border-4 border-indigo-500 border-t-transparent rounded-full mb-2"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
            </div>
        </div>
    </div>

    <script>
        const hostname = window.location.hostname;
        const BASE_URL = (hostname === 'localhost' || hostname === '127.0.0.1')
            ? 'http://localhost:8081/api/products' 
            : 'https://myproject-u2ca.onrender.com/api/products';

        async function loadData(url) {
            const loader = document.getElementById('loader');
            const tbody = document.getElementById('tableBody');
            loader.classList.remove('hidden');
            tbody.innerHTML = '';
            
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞: ' + response.status);
                const data = await response.json();
                const list = Array.isArray(data) ? data : [data];
                document.getElementById('count').innerText = list.length;

                if (list.length === 0 || !list[0]) {
                    tbody.innerHTML = '<tr><td colspan="4" class="p-10 text-center text-gray-400 text-base">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç üì≠</td></tr>';
                    return;
                }

                list.forEach(p => {
                    const row = `
                        <tr class="border-b hover:bg-indigo-50/50 transition-colors">
                            <td data-label="ID" class="px-5 py-4 text-gray-400 font-mono text-xs">${p.id}</td>
                            <td data-label="–ü—Ä–æ–¥—É–∫—Ç" class="px-5 py-4 font-bold text-gray-800">${p.name}</td>
                            <td data-label="–¶–µ–Ω–∞" class="px-5 py-4 text-green-600 font-bold">${p.price} ‚ÇΩ</td>
                            <td data-label="–î–µ–π—Å—Ç–≤–∏—è" class="px-5 py-4 text-right space-x-3">
                                <button onclick="startEdit(${p.id}, '${p.name}', ${p.price})" class="text-blue-500 hover:text-blue-700 transform hover:scale-110 transition">‚úèÔ∏è</button>
                                <button onclick="deleteProduct(${p.id})" class="text-red-500 hover:text-red-700 transform hover:scale-110 transition">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            } catch (err) {
                tbody.innerHTML = `<tr><td colspan="4" class="p-10 text-center text-red-500">‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</td></tr>`;
            } finally {
                loader.classList.add('hidden');
            }
        }

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (fetchAll, deleteProduct, saveProduct, resetForm, startEdit) 
        // –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ, –∫–∞–∫ –≤ –ø—Ä–æ—à–ª–æ–º –ø—Ä–∏–º–µ—Ä–µ. –ü—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä—É–π –∏—Ö –∏–∑ —Å–≤–æ–µ–≥–æ –∫–æ–¥–∞.
        
        async function fetchAll() { document.getElementById('searchInput').value = ''; await loadData(BASE_URL); }
        async function searchById() {
            const id = document.getElementById('searchInput').value;
            if (!id) return fetchAll();
            await loadData(`${BASE_URL}/${id}`);
        }
        async function deleteProduct(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')) return;
            const res = await fetch(`${BASE_URL}/${id}`, { method: 'DELETE' });
            if (res.ok) fetchAll();
        }
        async function saveProduct(event) {
            event.preventDefault();
            const id = document.getElementById('productId').value;
            const name = document.getElementById('name').value;
            const price = document.getElementById('price').value;
            const productData = { name, price: parseFloat(price) };
            const method = id ? 'PUT' : 'POST';
            const url = id ? `${BASE_URL}/${id}` : BASE_URL;
            const response = await fetch(url, {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(productData)
            });
            if (response.ok) { resetForm(); fetchAll(); }
        }
        function startEdit(id, name, price) {
            document.getElementById('formTitle').innerText = `–ò–∑–º–µ–Ω–∏—Ç—å #${id}`;
            document.getElementById('productId').value = id;
            document.getElementById('name').value = name;
            document.getElementById('price').value = price;
            document.getElementById('submitBtn').innerText = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
            document.getElementById('submitBtn').classList.replace('bg-indigo-600', 'bg-green-600');
            document.getElementById('cancelBtn').classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        function resetForm() {
            document.getElementById('productForm').reset();
            document.getElementById('productId').value = '';
            document.getElementById('formTitle').innerText = '–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç';
            document.getElementById('submitBtn').innerText = '–î–æ–±–∞–≤–∏—Ç—å';
            document.getElementById('submitBtn').classList.replace('bg-green-600', 'bg-indigo-600');
            document.getElementById('cancelBtn').classList.add('hidden');
        }

        fetchAll();
    </script>
</body>
</html>
